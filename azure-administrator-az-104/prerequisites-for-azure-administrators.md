# Prerequisites for Azure Administrators

## Configure Azure resources with tools. <a href="#configure-azure-resources-with-tools" id="configure-azure-resources-with-tools"></a>

### **Azure Cloud Shell** <a href="#configure-azure-resources-with-tools" id="configure-azure-resources-with-tools"></a>

Shell accessible from browser (Azure Portal) for managing Azure resources.

Is temporary and requires a new or existing Azure Files share to be mounted, a resource group and a storage account.

### **Azure PowerShell**

PowerShell module to enable Azure interaction and management. Also available from Azure Cloud Shell.

### **Azure CLI**

Command-line program to connect to Azure and execute administrative commands on Azure resources. Also available from Azure Cloud Shell by selecting _bash_ option.

Commands in the CLI are structured in _groups_ and _subgroups_. Each group represents a service provided by Azure, and the subgroups divide commands for these services into logical groupings.

Use `az find` to find a particular command and `--help` argument to get detailed information.

```bash
luishc@macbook ~ % az find blob
Finding examples...

Here are the most common ways to use [blob]:

Restore blobs in the specified blob range.
time=`date -u -d "30 minutes" '+%Y-%m-%dT%H:%MZ'`
az storage blob restore --account-name mystorageaccount -g MyResourceGroup -t $time -r container0/blob1 container0/blob2

Download a blob to a file path. (autogenerated)
az storage blob download --account-name mystorageaccount --auth-mode login --container-name mycontainer --file /path/to/file --name MyBlob

Restore blobs in two specified blob ranges. For examples, (container1/blob1, container2/blob2) and (container2/blob3..container2/blob4).
az storage blob restore --account-name mystorageaccount --resource-group MyResourceGroup --time-to-restore 2020-02-27T03:59:59Z --blob-range container1/blob1 container2/blob2 --blob-range container2/blob3 container2/blob4

luishc@macbook ~ % az storage blob --help

Group
    az storage blob : Manage object storage for unstructured data (blobs).
        Please specify one of the following authentication parameters for your commands: --auth-
        mode, --account-key, --connection-string, --sas-token. You also can use corresponding
        environment variables to store your authentication credentials, e.g. AZURE_STORAGE_KEY,
        AZURE_STORAGE_CONNECTION_STRING and AZURE_STORAGE_SAS_TOKEN.

Subgroups:
    copy                : Manage blob copy operations. Use `az storage blob show` to check the
                          status of the blobs.
    immutability-policy : Manage blob immutability policy.
    incremental-copy    : Manage blob incremental copy operations.
    lease               : Manage storage blob leases.
    metadata            : Manage blob metadata.
    service-properties  : Manage storage blob service properties.

Commands:
    delete              : Mark a blob or snapshot for deletion.
    delete-batch        : Delete blobs from a blob container recursively.
    download            : Download a blob to a file path.
    download-batch      : Download blobs from a blob container recursively.
    exists              : Check for the existence of a blob in a container.
    generate-sas        : Generate a shared access signature for the blob.
    list                : List blobs in a given container.
    query     [Preview] : Enable users to select/project on blob or blob snapshot data by
                          providing simple query expressions.
    restore             : Restore blobs in the specified blob ranges.
    rewrite   [Preview] : Create a new Block Blob where the content of the blob is read
                          from a given URL.
    set-legal-hold      : Set blob legal hold.
    set-tier            : Set the block or page tiers on the blob.
    show                : Get the details of a blob.
    snapshot            : Creates a snapshot of the blob.
    sync      [Preview] : Sync blobs recursively to a storage blob container.
    undelete            : Restore soft deleted blob or snapshot.
    update              : Sets system properties on the blob.
    upload              : Upload a file to a storage blob.
    upload-batch        : Upload files from a local directory to a blob container.
    url                 : Create the url to access a blob.

To search AI knowledge base for examples, use: az find "az storage blob"
```

## Use Azure Resource Manager <a href="#use-azure-resource-manager" id="use-azure-resource-manager"></a>

Azure Resource Manager (ARM) enables deploying, managing and monitoring resources as a group.

ARM API interaction:

<figure><img src="../.gitbook/assets/image (4) (1).png" alt=""><figcaption></figcaption></figure>

Benefits:

* You can deploy, manage, and monitor all the resources for your solution as a group, rather than handling these resources individually.
* You can repeatedly deploy your solution throughout the development lifecycle and have confidence your resources are deployed in a consistent state.
* You can manage your infrastructure through declarative templates rather than scripts.
* You can define the dependencies between resources so they're deployed in the correct order.
* You can apply access control to all services in your resource group because Role-Based Access Control (RBAC) is natively integrated into the management platform.
* You can apply tags to resources to logically organize all the resources in your subscription.
* You can clarify your organization's billing by viewing costs for a group of resources sharing the same tag.

Terminology:

* **resource** - Manageable item that is available through Azure (VMs, Storage Account, Database, Web App, Virtual Network...)
* **resource group** - Group of resources that are managed together. Can include all resources for a solution, or only part of the resources (whatever makes more sense for each specific case).
* **resource provider** - A service that supplies the resources you can deploy and manage through Resource Manager. Each resource provider offers operations for working with the resources that are deployed. The name of a resource type is in the format: **{resource-provider}/{resource-type}**. For example, the key vault type is **Microsoft.KeyVault/vaults**.
* **template** - JSON file used to define resources to be deployed to a resource group, also defines dependencies between resources.
* **declarative syntax** - Syntax that lets you state "Here is what I intend to create" without having to write the sequence of programming commands to create it. The Resource Manager template is an example of declarative syntax. In the file, you define the properties for the infrastructure to deploy to Azure.

### **Resource Groups**

* All the resources in your group should share the same lifecycle. You deploy, update, and delete them together. If one resource, such as a database server, needs to exist on a different deployment cycle it should be in another resource group.
* All resources must be in a resource group.
* Each resource can only exist in one resource group.
* Resource groups can't be nested.
* You can add or remove a resource to a resource group at any time.
* You can move a resource from one resource group to another group. Limitations do apply to [moving resources](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/move-support-resources).
* A resource group can contain resources that reside in different regions.
* A resource group can be used to scope access control for administrative actions.
* A resource can interact with resources in other resource groups. This interaction is common when the two resources are related but don't share the same lifecycle (for example, web apps connecting to a database).

When creating a resource group, you need to provide a location for it. This location is where the RG metadata will be stored.

### **Management Locks**

Locks can be created to avoid unwanted resource deletion.

They can be associated with a subscription, resource group or resource and are inherited by child resources.

Read-only locks prevents any changes to the resource and Delete locks prevents only resource deletion.

Only the Owner and User Access Administrator roles can create or delete management locks.

### **Managing Resources and Resource Groups**

Resource Groups and resources can be moved between subscription or resource groups.

During this operation, both source and target groups are locked (read-only lock).

Limitations to moving resources can be found \[here]\([Move operation support by resource type - Azure Resource Manager | Microsoft Learn](https://learn.microsoft.com/en-us/azure/azure-resource-manager/management/move-support-resources)).

Deleting a resource group deletes all resources within it.

Azure lets you view resource usage against limits to track usage and plan for future use (limits are bound to subscriptions).

### Configure resources with Azure Resource Manager templates <a href="#configure-resources-with-azure-resource-manager-templates" id="configure-resources-with-azure-resource-manager-templates"></a>

Defines all the Resource Manager resources in a deployment.

Benefits:

* Better consistency
* Dependency control when creating multiple resources
* Infrastructure as Code
* Reuse

ARM templates are written in JSON

```json
{
    /* Required. Location of json schema file that describes the version of the template language */
    "$schema": "http://schema.management.​azure.com/schemas/2019-04-01/deploymentTemplate.json#",​
    "contentVersion": "",​ /* Required. Template version */
    "parameters": {}, ​/* Values that are provided when deployment is executed to customize resource deployment */
    "variables": {}, /* Values that are used as JSON fragments in the template to simplify template language expressions */​
    "functions": [], /* User-defined functions that are available within the template */​
    "resources": [], /* Required. Resource types that are deployed or updated */​
    "outputs": {} /* Values that are returned after deployment​ */
}
```

Parameter section:

```json
"parameters": {
    "<parameter-name>" : {
        "type" : "<type-of-parameter-value>",
        "defaultValue": "<default-value-of-parameter>",
        "allowedValues": [ "<array-of-allowed-values>" ],
        "minValue": <minimum-value-for-int>,
        "maxValue": <maximum-value-for-int>,
        "minLength": <minimum-length-for-string-or-array>,
        "maxLength": <maximum-length-for-string-or-array-parameters>,
        "metadata": {
            "description": "<description-of-the parameter>"
        }
    }
}
/* example */
"parameters": {
  "adminUsername": {
    "type": "string",
    "metadata": {
      "description": "Username for the Virtual Machine."
    }
  },
  "adminPassword": {
    "type": "securestring",
    "metadata": {
      "description": "Password for the Virtual Machine."
    }
  }
}
```

### **Bicep**

Azure Bicep is a domain-specific language (DSL) that uses declarative syntax to deploy Azure resources. It is an abstraction over ARM template JSON to reduce complexity.

When a bicep template is submitted to ARM API, it is converted to JSON.

Closer to Terraform than JSON ARM templates.
